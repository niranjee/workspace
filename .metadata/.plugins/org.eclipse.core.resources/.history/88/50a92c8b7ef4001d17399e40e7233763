package packages;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;
import java.sql.Statement;
import org.postgresql.PGConnection;
import org.postgresql.PGNotification;
import com.tibco.bw.palette.shared.java.JavaProcessStarter;
import com.tibco.pe.plugin.EventContext;
import com.tibco.plugin.share.jdbc.JDBCUtils;

 

public class Start extends JavaProcessStarter {

    private static final String DATABASE_URL = "jdbc:postgresql://localhost:5432/postgres";

    private static final String USERNAME = "postgres";

    private static final String PASSWORD = "system";

    private static final String TIBCO_PROCESS_NAME = "process.bwp";

 

    public static void main(String[] args) {

        try (Connection connection = DriverManager.getConnection(DATABASE_URL, USERNAME, PASSWORD)) {

            PGConnection pgConnection = connection.unwrap(PGConnection.class);

            Statement statement = connection.createStatement();

 

            // Listen for notifications on a specific channel

            statement.execute("LISTEN your_channel");

 

            System.out.println("Listening for notifications...");

 

            while (true) {

                // Wait for a notification to be received

                PGNotification[] notifications = pgConnection.getNotifications();

 

                if (notifications != null) {

                    for (PGNotification notification : notifications) {

                        String payload = notification.getParameter();

                        System.out.println("Received notification: " + payload);

 

                        // Start your TIBCO custom process here

                        startTibcoProcess(payload);

                    }

                }

 

                // Add a delay between checks to avoid high CPU usage

                Thread.sleep(1000);

            }

        } catch (SQLException | InterruptedException e) {

            e.printStackTrace();

        }

    }

 

    private static void startTibcoProcess(String payload) {

        try {

            EventContext eventContext = new EventContext();

            eventContext.addInputParameter("your_parameter_name", payload);

 

            // Set additional input parameters if required

 

            // Start the TIBCO process

            // Replace "your_tibco_process_name" with the actual name of your TIBCO process

            JDBCUtils.invokeProcess(TIBCO_PROCESS_NAME, eventContext);

        } catch (Exception e) {

            e.printStackTrace();

        }

    }

}






